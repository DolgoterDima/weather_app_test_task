{"version":3,"file":"js/752.a3472303.js","mappings":"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","sources":["webpack://weather-app-test/./src/views/HomeView.vue","webpack://weather-app-test/src/views/HomeView.vue","webpack://weather-app-test/./src/views/HomeView.vue?2a07","webpack://weather-app-test/./src/views/HomeView.vue?aae2"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"home\"},[_c('div',{staticClass:\"days-list\"},[(_vm.loadingMessage)?_c('LoadingComponent',{attrs:{\"message\":_vm.loadingMessage}}):_vm._e(),_vm._l((_vm.daysList),function(day){return _c('DayCard',{key:day.id,staticClass:\"days-list__item\",attrs:{\"city\":day.city,\"id\":day.id},on:{\"remove\":_vm.removeDay,\"addToFavorite\":_vm.addDayToFavorite}})}),(_vm.isShowAddNewDay)?_c('button',{staticClass:\"days-list__add\",on:{\"click\":_vm.addNewDay}},[_c('font-awesome-icon',{attrs:{\"icon\":\"plus\",\"size\":\"xl\"}})],1):_vm._e()],2)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"home\">\n    <div class=\"days-list\">\n      <LoadingComponent :message=\"loadingMessage\" v-if=\"loadingMessage\" />\n      <DayCard\n        class=\"days-list__item\"\n        v-for=\"day in daysList\"\n        :city=\"day.city\"\n        :key=\"day.id\"\n        :id=\"day.id\"\n        @remove=\"removeDay\"\n        @addToFavorite=\"addDayToFavorite\"\n      />\n      <button class=\"days-list__add\" @click=\"addNewDay\" v-if=\"isShowAddNewDay\">\n        <font-awesome-icon icon=\"plus\" size=\"xl\" />\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport DayCard from \"@/components/cards/DayCard.vue\";\n import { EventBus } from \"@/event-bus\";\nimport { library } from \"@fortawesome/fontawesome-svg-core\";\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\";\nlibrary.add(faPlus);\n\nimport { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\n\nconst MAX_COUNT_OF_FAVORITES = 5;\nexport default {\n  name: \"HomeView\",\n\n  data() {\n    return {\n      daysList: [],\n      usersCity: \"222\",\n      favoritesList: [],\n\n      loadingMessage: \"\",\n    };\n  },\n  components: {\n    DayCard,\n    FontAwesomeIcon,\n  },\n  computed: {\n    isShowAddNewDay() {\n      return this.daysList.length < MAX_COUNT_OF_FAVORITES;\n    },\n  },\n  methods: {\n    async getCurrentUserCity() {\n      if (!navigator.geolocation) {\n        this.loadingMessage = \"Geolocation is not supported by this browser\";\n        return;\n      }\n\n      try {\n        this.loadingMessage = \"Detecting your current city\";\n\n        const position = await new Promise((resolve, reject) => {\n          navigator.geolocation.getCurrentPosition(resolve, reject);\n        });\n\n        const { latitude: lat, longitude: lon } = position.coords;\n        const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=en`;\n\n        const response = await fetch(url);\n        const data = await response.json();\n\n        this.loadingMessage = \"\";\n        this.daysList.push({ id: Date.now(), city: data.address.city });\n      } catch (error) {\n        if (error.code == error.PERMISSION_DENIED) {\n          this.loadingMessage = \"You disallow access to geolocation\";\n          setTimeout(() => {\n            this.loadingMessage = \"\";\n            this.addNewDay();\n          }, 3000);\n        } else {\n          this.loadingMessage = `${error}. Please enter city name manually`;\n          setTimeout(() => {\n            this.loadingMessage = \"\";\n          }, 5000);\n          console.log(`API error ${error}`);\n          this.addNewDay();\n        }\n      }\n    },\n    /* getCurrentUserCity() {\n      if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition( (position)=> {\n          this.loadingMessage = \"Detecting your current city\";\n\n            const lat = position.coords.latitude;\n            const lon = position.coords.longitude;\n            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=en`;\n\n            fetch(url)\n                .then((response) => response.json())\n                .then((data) => {\n                  this.loadingMessage = \"\";\n\n                  this.daysList.push({ id: Date.now(), city: data.address.city });\n                })\n                .catch((error) => {\n                  this.loadingMessage = `${error}. Please enter city name manually`;\n                  setTimeout(() => {\n                    this.loadingMessage = \"\";\n                  }, 5000);\n                  console.log(`API error ${error}`);\n                  this.addNewDay()\n                });\n\n         },  (error)=> {\n          if (error.code == error.PERMISSION_DENIED) {\n            this.loadingMessage = \"You disallow access to geolocation\";\n            setTimeout(()=>{\n              this.loadingMessage = \"\";\n              this.addNewDay()\n            }, 3000)\n          }\n        });\n      } else {\n        this.loadingMessage = \"Geolocation is not supported by this browser \";\n\n\n\n      }\n\n\n    },*/\n    removeDay(e) {\n      EventBus.$emit(\"open-popup\", {\n        text: `Do you really want to remove city? `,\n        id: e,\n      });\n      /*\n      this.daysList = this.daysList.filter((item) => item.id !== e);\n*/\n    },\n    addNewDay() {\n      this.daysList.push({ id: Date.now(), city: \"\" });\n    },\n    addDayToFavorite({ id, city }) {\n      /* проверка есть ли город в списке и не больше ли 5 городов в списке если нет, то добавляем*/\n      const isCityInFavorites = this.favoritesList.find(\n        (item) => item.city === city\n      );\n      const isFavoritesListMoreThenAllowedCount =\n        this.favoritesList.length > MAX_COUNT_OF_FAVORITES;\n\n      if (!isCityInFavorites && !isFavoritesListMoreThenAllowedCount) {\n        this.favoritesList.push({ id, city });\n        localStorage.setItem(\n          \"favoritesList\",\n          JSON.stringify(this.favoritesList)\n        );\n\n        /* change icon in card to filled heart when it added in favorites list */\n        EventBus.$emit(\"added-to-favorites\", id);\n      }\n\n      if (isFavoritesListMoreThenAllowedCount) {\n        EventBus.$emit(\"open-popup\", {\n          text: \"You can`t add more then 5 cities \",\n          id: false,\n        });\n      }\n\n      if (isCityInFavorites) {\n        EventBus.$emit(\"open-popup\", {\n          text: \"This city is already in your favorites\",\n          id: false,\n        });\n      }\n    },\n  },\n  mounted() {\n    /* this.addNewDay()*/\n    this.getCurrentUserCity();\n    console.log(\"localStorage\", localStorage.getItem(\"favoritesList\"));\n    this.favoritesList =\n      JSON.parse(localStorage.getItem(\"favoritesList\")) || [];\n  },\n  created() {\n    EventBus.$on(\"delete-card\", (id) => {\n      this.daysList = this.daysList.filter((item) => item.id !== id);\n    });\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./HomeView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./HomeView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./HomeView.vue?vue&type=template&id=50835c38&\"\nimport script from \"./HomeView.vue?vue&type=script&lang=js&\"\nexport * from \"./HomeView.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","loadingMessage","attrs","_e","_l","daysList","day","key","id","city","on","removeDay","addDayToFavorite","isShowAddNewDay","addNewDay","staticRenderFns","library","faPlus","MAX_COUNT_OF_FAVORITES","name","data","usersCity","favoritesList","components","DayCard","FontAwesomeIcon","computed","length","methods","navigator","geolocation","position","Promise","resolve","reject","getCurrentPosition","latitude","lat","longitude","lon","coords","url","response","fetch","json","push","Date","now","address","error","code","PERMISSION_DENIED","setTimeout","console","log","e","EventBus","text","isCityInFavorites","find","item","isFavoritesListMoreThenAllowedCount","localStorage","setItem","JSON","stringify","mounted","getCurrentUserCity","getItem","parse","created","filter","component"],"sourceRoot":""}